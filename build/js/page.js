Array.prototype.random||(Array.prototype.random=function(){return this.splice(Math.floor(Math.random()*this.length),1)[0]}),Array.prototype.remove||(Array.prototype.remove=function(r){var t=this.length;if("function"!=typeof r)throw new TypeError;for(var o=arguments[1],e=t;e>0;e+=1)e in this&&!r.call(o,this[e],e,this)&&this.splice(e,1)}),Array.prototype.every||(Array.prototype.every=function(r){var t=this.length;if("function"!=typeof r)throw new TypeError;for(var o=arguments[1],e=0;t>e;e++)if(e in this&&!r.call(o,this[e],e,this))return!1;return!0}),Array.prototype.filter||(Array.prototype.filter=function(r){var t=this.length;if("function"!=typeof r)throw new TypeError;for(var o=new Array,e=arguments[1],n=0;t>n;n++)if(n in this){var i=this[n];r.call(e,i,n,this)&&o.push(i)}return o}),Array.prototype.someIndexOf||(Array.prototype.someIndexOf=function(r){var t=this.length;if("function"!=typeof r)throw new TypeError;var o=arguments[1],e=Number(arguments[2])||0;for(e=0>e?Math.ceil(e):Math.floor(e),0>e&&(e+=t);t>e;e++)if(e in this&&r.call(o,this[e],e,this))return e;return-1}),Array.prototype.indexOf||(Array.prototype.indexOf=function(r){var t=this.length,o=Number(arguments[1])||0;for(o=0>o?Math.ceil(o):Math.floor(o),0>o&&(o+=t);t>o;o++)if(o in this&&this[o]===r)return o;return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(r){var t=this.length,o=Number(arguments[1]);for(isNaN(o)?o=t-1:(o=0>o?Math.ceil(o):Math.floor(o),0>o?o+=t:o>=t&&(o=t-1));o>-1;o--)if(o in this&&this[o]===r)return o;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(r){var t=this.length;if("function"!=typeof r)throw new TypeError;for(var o=arguments[1],e=0;t>e;e++)e in this&&r.call(o,this[e],e,this)}),Array.prototype.map||(Array.prototype.map=function(r){var t=this.length;if("function"!=typeof r)throw new TypeError;for(var o=new Array(t),e=arguments[1],n=0;t>n;n++)n in this&&(o[n]=r.call(e,this[n],n,this));return o}),Array.prototype.some||(Array.prototype.some=function(r){var t=this.length;if("function"!=typeof r)throw new TypeError;for(var o=arguments[1],e=0;t>e;e++)if(e in this&&r.call(o,this[e],e,this))return!0;return!1});
!function(){window.FunctionValidation=function(n,e,t){var r=FunctionValidation.caller.name;t.forEach(function(t){if("undefined"==typeof e[t.name])throw new TypeError("Exception in "+r+"(): "+t.name+" was not provided!");if(!(e[t.name].constructor===t.type||e[t.name]instanceof t.type))throw new TypeError("Exception in "+r+"(): "+t.name+" was not the valid type. Expecting: "+t.type.name);if(t.type===Array&&"undefined"!=typeof t.arrayType&&e[t.name].filter(function(n){return!(n.constructor===t.arrayType||n.constructor instanceof t.arrayType)}).length>0)throw new TypeError("Exception in "+r+"(): "+t.name+" is an array type but not all elements were of type "+t.arrayType.name);n[t.name]=e[t.name]})}}(jQuery);
!function(t){window.Sprite=function(i){FunctionValidation(this,i,[{name:"filename",type:String},{name:"id",type:String},{name:"row_id",type:String},{name:"row_data",type:Array,arrayType:String},{name:"row_height",type:Number},{name:"col_id",type:String},{name:"col_data",type:Array,arrayType:String},{name:"col_width",type:Number}]);for(var a="."+this.id+" {width:"+this.col_width+"px; height:"+this.row_height+'px; background: url("'+this.filename+'")}\n',e=0;e<this.col_data.length;e+=1)for(var r=0;r<this.row_data.length;r+=1){var d="[data-"+this.row_id+'="'+this.row_data[r]+'"]',o="[data-"+this.col_id+'="'+this.col_data[e]+'"]',n="-"+e*this.col_width+"px",s="-"+r*this.row_height+"px";a+="."+this.id+d+o+" {background-position:"+n+" "+s+"}\n"}$styles=t("#sprite-"+this.id),0===$styles.size()?t("head").append('<style type="text/css" id="sprite-'+this.id+'">'+a+"</style>"):$styles.html(a)},Sprite.domElement="div",Sprite.prototype.get=function(i){var a=null,e=null,r=this;"undefined"!=typeof i&&t.each(i,function(t,i){if(r.row_id===t){if(!(r.row_data.indexOf(i)>-1))throw new TypeError("Exception in Sprite.prototype.get: "+t+" was provided but "+i+" is not a valid key.");a=i}else{if(r.col_id!==t)throw new TypeError("Exception in Sprite.prototype.get: "+t+" was not found in either row_id or col_id");if(!(r.col_data.indexOf(i)>-1))throw new TypeError("Exception in Sprite.prototype.get: "+t+" was provided but "+i+" is not a valid key.");e=i}});var d=[];if(null!==a&&null!==e)d.push(t("<"+Sprite.domElement+">").addClass(this.id).attr("data-"+this.row_id,a).attr("data-"+this.col_id,e));else if(null===a&&null!==e)this.row_data.forEach(function(i){d.push(t("<"+Sprite.domElement+">").addClass(this.id).attr("data-"+this.row_id,i).attr("data-"+this.col_id,e))},this);else if(null===e&&null!==a)this.col_data.forEach(function(i){d.push(t("<"+Sprite.domElement+">").addClass(this.id).attr("data-"+this.row_id,a).attr("data-"+this.col_id,i))},this);else for(var o=0;o<this.col_data.length;o+=1)for(var n=0;n<this.row_data.length;n+=1)d.push(t("<"+Sprite.domElement+">").addClass(this.id).attr("data-"+this.row_id,this.row_data[n]).attr("data-"+this.col_id,this.col_data[o]));return d}}(jQuery);
!function(t){window.Bets=function(t){this.winnings=t||100,this.currentBet=null,this.name="sample-bets"},Bets.prototype.start=function(e){this.betsCallback=e,t("#current-bet-interface").css("display","")},Bets.prototype.finish=function(e){var n=e.data.bets,i=parseInt(t("#currentBet").val(),10);isNaN(i)?t("#bet-error").html("Enter a number, dummy."):i>n.winnings?t("#bet-error").html("You don't have that much to bet!"):0>i?t("#bet-error").html("The bet needs to be positive!"):(t("#bet-error").html(""),n.winnings-=i,n.currentBet=i,n.betsCallback.call(),t("#winnings").html(n.winnings),t("#current-bet-interface").css("display","none"))},Bets.prototype.abort=function(){this.currentBet=null,this.betsCallback=null,t("#bet-error").html(""),t("#current-bet-interface").css("display","none")},Bets.prototype.win=function(e){this.winnings+=(e?2:0)*this.currentBet,this.currentBet=null,t("#winnings").html(this.winnings)},Bets.prototype.css=function(){return""},Bets.prototype.output=function(){var e=this,n=t("<fieldset id='bets-interface'></fieldset>").append("<legend>Betting Interface</legend>").append(function(){var n=t("<div id='bets-winnings'>Your winnings: </div>").append(t("<span id='winnings'>"+e.winnings+"</span>"));return n}).append(function(){var n=t("<div id='current-bet-interface'></div>").css("display","none").append("<div id='bet-error'></div>").append(function(){var n=t("<form action='javascript:void(0);'></form>").append("<label for='currentBet'>Current Bet</label>").append("<input value='5' type='text' id='currentBet'>").append(t("<input type='submit' value='Set it'>").click({bets:e},e.finish));return n});return n});return n[0]}}(jQuery);
!function(t){function a(a){var s=t(this),e=s.attr("data-value");a.data.bets.stacks[e]--;var n=t('.stack-group .stack[data-value="'+e+'"]',this.container);0===n.size()?t("<div></div>").attr("data-value",e).attr("data-count","1").addClass("stack").appendTo(".stack-group"):n.attr("data-count",parseInt(n.attr("data-count"))+1),a.data.bets.update()}function s(a){var s=t(this),e=s.attr("data-value"),n=s.attr("data-count");a.data.bets.stacks[e]++,s.attr("data-count",--n),0===n&&s.remove(),a.data.bets.update()}window.Chips=function(t){this.name="chips",this.winnings=t||100,this.types=[{value:1,cssColor:"#000",cssBackground:"#ccc",selectedBackground:"yellow"},{value:5,cssColor:"#000",cssBackground:"#c00",selectedBackground:"yellow"},{value:25,cssColor:"#000",cssBackground:"#0c0",selectedBackground:"yellow"},{value:100,cssColor:"#fd0",cssBackground:"#222",selectedBackground:"yellow"}],this.stacks={},this.types.forEach(function(t){this.stacks[t.value]=0},this),this.split(this.winnings)},Chips.prototype=new Bets,Chips.prototype.split=function(t){this.types.sort(function(t,a){return a.value-t.value}).forEach(function(a){for(;t>=a.value;)this.stacks[a.value]++,t-=a.value},this)},Chips.prototype.update=function(){var a=this.stacks;t("#winnings .stack",this.container).each(function(){var s=t(this),e=s.attr("data-value"),n=a[e];s.attr("data-count",n)}),this.fix()},Chips.prototype.fix=function(){t(".stack",this.container).each(function(){var a=t(this),s=a.attr("data-count");a.css("height",9*--s+"px").html('<span class="value">'+a.attr("data-value")+"</span>")});var a=t(".stack-group").children().size(),s=0;t(".stack-group .stack",this.container).each(function(){var e=t(this),n=e.index();s+=parseInt(e.attr("data-count")),t(this).css("top",9*n+"px").css("zIndex",a-n)}),t(".stack-group").css("height",9*s+"px")},Chips.prototype.start=function(e){this.callback=e,t("#current-bet-interface").css("display",""),t("#winnings .stack",this.container).on("click",{bets:this},a),t(".stack-group",this.container).on("click",".stack",{bets:this},s)},Chips.prototype.finish=function(e){var n=e.data.bets;if($pendingChips=t(".stack-group .stack",this.container),$betsError=t("#bet-error",this.container),0===$pendingChips.size())$betsError.html("You must select some chips to bet!");else{$betsError.html("");var i=0;$pendingChips.each(function(){i+=t(this).attr("data-count")*t(this).attr("data-value")}),t("#current-bet-interface").css("display","none"),t("#winnings .stack",this.container).off("click",a),t(".stack-group",this.container).off("click",s),t(".stack-group").empty(),n.currentBet=i,n.callback.call(),n.callback=null}},Chips.prototype.win=function(t){t&&this.split(2*this.currentBet),this.currentBet=null,this.update()},Chips.prototype.abort=function(){this.currentBet=null,this.callback=null,t("#current-bet-interface").css("display","none"),t("#winnings .stack",this.container).off("click",a),t(".stack-group",this.container).off("click",s)},Chips.prototype.output=function(){var a=this.types.map(function(a){var s=t("<div></div>").addClass("stack").attr("data-value",a.value).attr("data-count",0);return s}),s=this,e=t("<fieldset id='bets-interface'></fieldset>").append("<legend>Betting Interface</legend>").append(function(){var s=t("<div id='bets-winnings'>Your winnings: </div>").append(function(){return t("<div id='winnings'></div>").append(a)});return s}).append(function(){var a=t("<div id='current-bet-interface'></div>").css("display","none").append("<div id='bet-message'>Click chips above to bet them. Click finished once ready.</div>").append("<div class='stack-group'></div>").append(function(){var a=t("<button id='finish-bet'>Finished</button>").on("click",{bets:s},s.finish);return a}).append("<div id='bet-error'></div>");return a});return e[0]},Chips.prototype.css=function(){var t="";return this.types.forEach(function(a){t+="\n.stack[data-value='"+a.value+"'],",t+="\n.stack[data-value='"+a.value+"']:after,",t+="\n.stack[data-value='"+a.value+"']:before { ",t+="\n  background-color: "+a.cssBackground+";",t+="\n  color: "+a.cssColor+";",t+="\n}",t+="\n.stack[data-value='"+a.value+"'].selected,",t+="\n.stack[data-value='"+a.value+"'].selected:after,",t+="\n.stack[data-value='"+a.value+"'].selected:before { ",t+="\n  background-color: "+a.selectedBackground+";",t+="\n}"}),t}}(jQuery);
!function(t){window.Game=function(){this.name="sample-game",this.label="Sample Game"},Game.prototype.toString=function(){return"Game ["+this.name+"]"},Game.prototype.init=function(){var n=0===this.bets.winnings;t(this.container).removeClass().addClass("game init").toggleClass("bust",n),t(".status",this.container).html(n?"You have no money - get out of here you lazy bum!":"Press start to continue")},Game.prototype.fin=function(){t(this.container).removeClass().addClass("game")},Game.prototype.start=function(n){var e=n.data.game,a=e.container,i=e.bets;t(a).removeClass().addClass("game betting"),t(".status",a).html("Enter a bet to continue..."),i.start(function(){t(a).removeClass().addClass("game playing"),t(".status",a).html("Current bet is "+i.currentBet)})},Game.prototype.end=function(n){var e=n.data.winning,a=n.data.game,i=a.bets;i.win(e),a.init(),t(".status",a.container).prepend(e?"You win! ":"You lose... ")},Game.prototype.output=function(){var n=this,e=t("<fieldset class='"+this.name+"'></fieldset>").append("<legend>"+this.label+"</legend>").append(function(){var e=t("<div class='commands'></div>").append("<span class='status'></span>").append(t("<button class='start'>Start</button>").click({game:n},n.start));return e}).append(function(){var e=t("<div class='interface'></div>").append(t("<button>Win</button>").click({game:n,winning:!0},n.end)).append(t("<button>Lose</button>").click({game:n,winning:!1},n.end));return e});return this.container=e[0],this.container},Game.prototype.css=function(){var t="";return t+="#"+this.name+" { display:none; }",t+="#"+this.name+".init { display:inherit; }",t+="#"+this.name+".init .interface{ display:none; }",t+="#"+this.name+".init .start{ display:inherit; }",t+="#"+this.name+".betting { display:inherit; }",t+="#"+this.name+".betting .interface { display:none; }",t+="#"+this.name+".betting .start { display:none; }",t+="#"+this.name+".playing { display:inherit; }",t+="#"+this.name+".playing .interface { display:inherit; }",t+="#"+this.name+".playing .start { display:none; }",t+="#"+this.name+".bust { display:inherit; }",t+="#"+this.name+".bust .start{ display:none; }",t+="#"+this.name+".bust .interface{ display:none; }"}}(jQuery);
!function(e){window.GameInterface=function(t){FunctionValidation(this,t,[{name:"output",type:HTMLElement},{name:"games",type:Array,arrayType:Game},{name:"bets",type:Bets}]);var n=this;this.games.forEach(function(e){e.bets=this.bets},this),Array.prototype.concat(this.games,this.bets).forEach(function(t){var n=(t instanceof Game?"game":"bet")+"--"+t.name,a=e("#"+n),s=t.css();0===a.size()?e("head").append('<style type="text/css" id="'+n+'">'+s+"</style>"):a.html(s)});var a;e(this.output).append(function(){var t=e("<fieldset id='game-chooser'></fieldset>").append("<legend>Game Chooser</legend>").append(function(){return a=e("<select id='game-selection'></select>").append("<option value=''>Select One</option>").append(function(){return n.games.map(function(e,t){return"<option value='"+t+"'>"+e.label+"</option>"})})}).append(function(){var t=e("<button id='game-starter'>Start</button>").click(function(){$selected=e("#game-selection").val(),""!=$selected&&(e("#game-selection").css("display","none"),e("#game-starter").css("display","none"),e("#game-ender").css("display",""),n.current=n.games[$selected],n.current.init())});return t}).append(function(){var t=e("<button id='game-ender'>Leave</button>").css("display","none").click(function(){e("#game-selection").css("display",""),e("#game-starter").css("display",""),e("#game-ender").css("display","none"),n.current.fin(),n.current=void 0,n.bets.abort()});return t});return t}).append(function(){return n.games.map(function(t){var n=e(t.output());return n.attr("id",t.name),n})}).append(this.bets.output()),this.bets.update()}}(jQuery);
!function(t){window.Blackjack=function(){this.name="blackjack",this.label="Blackjack"},Blackjack.prototype=new Game,Blackjack.prototype.init=function(){},Blackjack.prototype.fin=function(){},Blackjack.prototype.start=function(){},Blackjack.prototype.end=function(){},Blackjack.prototype.output=function(){var n=t("<fieldset class='"+this.name+"'></fieldset>").append("<legend>"+this.label+"</legend>");return n},Blackjack.prototype.css=function(){var t="";return t+="#"+this.name+" { display:none; }",t+="#"+this.name+".init { display:inherit; }",t+="#"+this.name+".init .interface{ display:none; }",t+="#"+this.name+".init .start{ display:inherit; }",t+="#"+this.name+".betting { display:inherit; }",t+="#"+this.name+".betting .interface { display:none; }",t+="#"+this.name+".betting .start { display:none; }",t+="#"+this.name+".playing { display:inherit; }",t+="#"+this.name+".playing .interface { display:inherit; }",t+="#"+this.name+".playing .start { display:none; }",t+="#"+this.name+".bust { display:inherit; }",t+="#"+this.name+".bust .start{ display:none; }",t+="#"+this.name+".bust .interface{ display:none; }"}}(jQuery);


!function(e){e(function(){e(".no-js").removeClass("no-js");var t=function(){this.name="sample-game-1",this.label="Sample Game #1"};t.prototype=new Game,t.prototype.css=function(){var e=Object.getPrototypeOf(this),t=Object.getPrototypeOf(e).css.call(this);return t+"#"+this.name+"{color:blue}"};var a=function(){this.name="sample-game-2",this.label="Sample Game #2"};a.prototype=new Game;new GameInterface({output:e("#output")[0],games:[new t,new a,new Blackjack],bets:new Chips(144)})})}(jQuery);
